# -*- coding: cp1252 -*-

#Definciones - pistas
dcion_ardilla = '''Es un roedor que come frutos
secos y vive en los arboles de los bosques
y de los parques. Suele pararse sobre sus dos patas
traceras, que son mas grandes que las otras.'''
dcion_caballo = '''Mamifero herbivoro de cuello
largo y arqueado de la familia de los
equinos, con cuatro veloces patas.'''
dcion_camello ='''Mamifero y herbivoro de cuatro
patas largas y delgadas caracterizado
por tener una o dos jorobas en el lomo. '''
dcion_chimpance = '''Mono de unos 150 centimetros
de alto, con pelaje negro, nariz
aplastada y muy amigable.El simio
 mas parecido al humano.'''
dcion_cocodrilo ='''Reptil de gran tamano,
de vida semi-acuatica, con una
larga y fuerte cola, cinco dedos
en sus patas delanteras y cuatro
en las traseras.Tienen unos fuertes
y afilados dientes. Es carnivoro y
muy temible. Habita en los grandes
rios de regiones intertropicales. '''
dcion_conejo ='''Mamifero de 40 cm de longitud,
pelo suave, orejas largas, cola corta
y patas traseras mas desarrolladas que
las delanteras. Vive en madrigueras y
se reproduce con mucha rapidez.'''
dcion_delfin ='''De la familia de los cetaceos,
animal marino conocido por su gran inteligencia,
puede medir entre 3 y 9 metros de largo, tiene una
cabeza grande y hocico alargado, parecido a una
botella. Muy habil para realizar piruetas.'''
dcion_elefante ='''Mamifero de gran tamano, el mas
grande de los terrestre hoy en dia.
Tienen la piel color gris oscuro,
gruesa, rugosa sin pelo. Posee grandes
orejas colgantes y una larga trompa.'''
dcion_flamenco ='''Ave con dos patas largas y angostas,
al igual que su cuello.
Poseen plumas de color rosado. '''
dcion_gallina ='''Ave de unos 50 centimetros aproximados,
comunmente los encontras en la granja.
Es incapaz de volar a grandes distancias.'''
dcion_gato ='''Felino pequeno, que hace de muy buena mascota.'''
dcion_gaviota ='''Una de las aves mas conocidas en las costas.
Con un plumaje blanco y color ceniza,
pico largo y con forma de gancho.
Vuela mucho y se alimenta de los
peces que encuentra en el mar.'''
dcion_gorila ='''Primate de unos 2 metros
de altura, y con un pelaje de color oscuro.
Se alimenta de hojas y frutos y habita
en Africa. En otras partes del mundo
solo se los puede ver en zoologicos. '''
dcion_hipopotamo ='''Mamifero acuatico de piel gruesa y oscura.
Tiene un cuerpo voluminoso, patas
cortas y cabeza grande con orejas, ojos y
nariz en la parte de arriba, lo que les permite
respirar cuando estan adentro el agua.'''
dcion_jirafa ='''Mamifero d 5 metros de alto, herbivoro
con el cuello largo y esbelto, cabeza pequena
y dos pequenos cuernos. Posee un pelaje
amarillo con manchas oscuras.'''
dcion_leon ='''Felino carnivoro, que puede alcanzar
hasta 3 metros de largo! Tiene un pelaje
amarillo y rojizo, con una cabeza
grande, dientes y u?as muy fuertes y cola
larga. El macho tiene una gran melena.
Se lo conoce como "El rey de la selva",
aunque vive en la sabana africana.'''
dcion_leopardo ='''Felino carnivoro, de hasta 2 metros
y medio de largo. pelo amarillo rojizo
con manchas negras y redondas. Vive en los
bosques de Asia y Africa. Es muy agil.'''
dcion_mariposa ='''Insecto con dos pares de alas,
generalmente de colores llamativos.'''
dcion_orangutan ='''Primate de hasta 2 metros de alto,
cabeza alargada, nariz chata y hocico
saliente.Posee un cuerpo robusto con
brazos mas largos que las piernas; con un pelaje espeso
y rojizo. Vive en algunas selvas de Africa.'''
dcion_paloma ='''Ave, muy comun en las ciudades,
sobre todo en las plazas.
Existen muchas variedades por tama?o y color.'''
dcion_panda ='''Mamifero, de la familia de los osos,
con un pelaje blanco y negro.Se alimenta de vegetales.
Viven en los bosques de Bambu de China.'''
dcion_perro='''Mamifero carnivoro, de la familia
de los caninos, de tama?o, forma y pelaje
variado segun la raza. Esta muy adaptado
para vivir con las familias en la casa.'''
dcion_pez='''Animal vertebrado acuatico con branquias
para respirar en el agua. Tiene extremidades
con forma de aletas que le permiten, y poseen
una piel cubierta por escamas.'''
dcion_pinguino ='''Hay distintas variedades. Los mas
comunes son los de plumaje negro y
vientre blanco que miden entre 90
centimetros y 1 metro. Poseen alas
pero no son aptas para volar. '''
dcion_puma ='''Felino un poco mas largo que dos metros,
con pelaje pardo rojizo. Habita en America.'''
dcion_rinoceronte ='''Mamifero que mide hasta 3,50 metros
de largo y 1,50 de alto. De patas cortas
y fuertes. Piel gruesa y uno o dos
cuernos norvos sobre la nariz.'''
dcion_tiburon ='''Nombre de un grupo de peces marinos
que poseen varias filas de dientes
agudos y cortantes. La mayoria de ellos
son carnivoros.'''
dcion_tigre ='''Felino carnivoro de hasta 3 metros
de largo, contando la cola. Con pelaje color
amarillo con rayas negras en el lomo y cola,
y con el vientre balnco. Tienen mucha fuerza y agilidad para
el salto,y  unas poderosas y grandes mandibulas.'''
dcion_toro = '''Mamifero rumeante, macho, de unos 150
centimetros de alto. Cuerpo muy robusto,
pelo corto, y cabeza provista de dos cuernos
curvos y puntiagudos, hocico ancho, papada
 en el pecho y cola.'''
dcion_vaca = '''Mamifero rumeante, hembra,
de unos 150 centimetros de alto.
Con cuerpo muy robusto, pelo corto y cabeza
gruesa provista de dos cuernos curvos y puntiagudos.
Nos provee la leche, carne y el cuero.'''
dcion_ciervo ='''Mamifero rumiante de color pardo,
pelo aspero y corto. Patas largas y cola corta.
El macho tiene unas astas, o bien cuernos,
que renueva todos los anos.'''
dcion_raton = '''Roedor de unos 20 centimetros,
generalmente viven en casas o campos.'''
dcion_cebra = '''Mamifero parecidoa un asno, de pelo
 blanco amarillento con rayas transversales negras.'''

definiciones = dict([('ardilla',dcion_ardilla),('caballo',dcion_caballo), ('camello',dcion_camello),('chimpance',dcion_chimpance),
                     ('cocodrilo',dcion_cocodrilo),('conejo',dcion_conejo),('delfin',dcion_delfin),('elefante',dcion_elefante),
                     ('flamenco',dcion_flamenco),('gallina',dcion_gallina),('gato',dcion_gato),('gaviota',dcion_gaviota),
                     ('gorila',dcion_gorila),('hipopotamo',dcion_hipopotamo),('jirafa',dcion_jirafa),('leon',dcion_leon),
                     ('leopardo',dcion_leopardo),('mariposa',dcion_mariposa),('orangutan',dcion_orangutan),
                     ('paloma',dcion_paloma),('panda',dcion_panda),('perro',dcion_perro),('pez',dcion_pez),
                     ('pinguino',dcion_pinguino),('puma',dcion_puma),('raton',dcion_raton), ('rinoceronte',dcion_rinoceronte),
                     ('tiburon',dcion_tiburon),('tigre',dcion_tigre),('toro',dcion_toro),('vaca',dcion_vaca), ('ciervo',dcion_ciervo),('cebra',dcion_cebra)])

lista_n1 = ['conejo','toro','jirafa','leon','panda','perro','pez','puma','tigre','vaca','gato','cebra']
lista_n2 = ['ardilla','caballo','camello','cocodrilo','delfin','elefante','gorila','paloma','tiburon','ciervo','gallina','raton']
lista_n3 = ['chimpance','flamenco','hipopotamo','leopardo','mariposa','orangutan','pinguino','rinoceronte','gaviota']

import pilas
import random
import pickle
from pilas.escena import Base
from animales import Animal
from cuadrito import cuadro_para_letra
from vidas_minijuego import ContadorDeVidas
from escena_ayuda2 import ayuda_minijuego

def ver_ayuda():
    pilas.almacenar_escena(ayuda_minijuego())

def cuando_pulsa_tecla(evento):
        if evento.texto == 'a':
            ver_ayuda()


class minijuego_animales(Base):

    def __init__(self,nivel =1):
        Base.__init__(self)
        self.nivel = nivel
        self.ok = 1
        self.sonido_good = pilas.sonidos.cargar("data/musica/yay_sound.ogg")
        self.sonido_bad = pilas.sonidos.cargar("data/musica/fail_sound.ogg")
        self.sonido_perdio = pilas.sonidos.cargar("data/musica/aww_sound.ogg")

    def iniciar (self):
        pilas.fondos.Color(pilas.colores.violeta)
        pilas.avisar("Preciona la 'A' para ver la ayuda")
        self.pulsa_tecla.conectar(cuando_pulsa_tecla)
        self.vidas = ContadorDeVidas(3)
        pts_iniciales = str(90 + (self.nivel-1)*20)
        self.puntos = pilas.actores.Puntaje(texto=pts_iniciales,y=320,x=450,color=pilas.colores.blanco)
        self.animal = self.elegir_animal()
        self.iniciar_pistas()
        self.crear_elementos()
        self.colisiones.agregar(self.grupo_cuadros,self.carteles_letras,self.coloco_letra)
        self.boton_terminado()
        ver_ayuda()

    #def inciar_juego(self):

    def elegir_animal (self):
        if self.nivel ==1:
            return random.choice(lista_n1)
        elif self.nivel ==2:
            return random.choice(lista_n2)
        elif self.nivel==3:
            return random.choice(lista_n3)

    def crear_elementos(self):
        cant_letras = len(self.animal)
        #Calculamos comienzo en y de palabra a completar
        pos = -((cant_letras/2)*67)
        #Iniciamos la primer letra
        primera_letra = pilas.actores.Texto(self.animal[0].upper(),x=pos,y=200,fuente="data/tipografias/dnrsq.ttf")
        primera_letra.escala = 2
        primera_letra.color = pilas.colores.azuloscuro
        pos = pos + 67
        #Creamos los cuados punteados correspondientes para cada letra
        self.grupo_cuadros = pilas.grupo.Grupo()
        for i in range(1,cant_letras):
            c = cuadro_para_letra(x=pos,y=200)
            letra = self.animal[i].upper()
            c.set_letra(letra)
            pos = pos + 67
            self.grupo_cuadros.append(c)
        #Creamos letras (2 lineas con 10 letras cada una)
        self.letras()

    def letras(self):
        ABC = ['A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S',
            'T','U','V','W','X','Y','Z']
        #Creamos lista con letras correctas + al azar
        self.lista_letras = []
        letras_palabra = len(self.animal)
        for i in range(1,letras_palabra):
            self.lista_letras.append(self.animal[i].upper())
        for i in range(letras_palabra,22):
            l = random.choice(ABC)
            self.lista_letras.append(l)
        self.lista_letras.sort()
        self.crear_carteles()

    def crear_carteles(self):
        self.carteles_letras = pilas.grupo.Grupo()
        #Primera linea
        pos = -265
        for i in range(11):
            l = pilas.actores.Texto(self.lista_letras[i],x=pos,y=-150,fuente="data/tipografias/dnrsq.ttf")
            l.escala = 2
            l.aprender(pilas.habilidades.Arrastrable)
            l.color = pilas.colores.cyan
            l.radio_de_colision = 10
            self.carteles_letras.append(l)
            pos = pos + 65
        #Segunda linea
        pos = -265
        for i in range(11,21):
            l = pilas.actores.Texto(self.lista_letras[i],x=pos,y=-210,fuente="data/tipografias/dnrsq.ttf")
            l.escala = 2
            l.aprender(pilas.habilidades.Arrastrable)
            l.color = pilas.colores.cyan
            l.radio_de_colision =10
            self.carteles_letras.append(l)
            pos = pos + 65

    def iniciar_pistas(self):
        self.boton_pista_foto = pilas.interfaz.Boton("Ver la foto",y=-320,x=200)
        self.boton_pista_foto.conectar(self.mostrar_foto)
        self.boton_pista_definicion = pilas.interfaz.Boton("Leer definicion",y=-320,x=-200)
        self.boton_pista_definicion.conectar(self.mostrar_definicion)

    def mostrar_definicion(self):
        self.boton_pista_foto.desactivar()
        self.boton_pista_definicion.desactivar()
        #Inicionar definicion
        des = definiciones[self.animal]
        time = int(len(des)*0.10)
        texto = pilas.actores.Texto(des)
        #Se restan 10 puntos por leer definicion
        self.puntos.aumentar(-10)
        self.puntos.escala = [2,1]
        #Se muestra la definicion por 9 segundos
        tiempo=pilas.actores.Temporizador(y=-320)
        tiempo.color = pilas.colores.negro
        tiempo.escala = [2,1,2,1,2,1],time
        def termino_el_tiempo():
            pts = self.puntos.obtener()
            tiempo.eliminar()
            texto.eliminar()
            if pts>51:
                self.boton_pista_foto.activar()
            if pts>9:
                self.boton_pista_definicion.activar()
        tiempo.ajustar(time,termino_el_tiempo)
        tiempo.iniciar()

    def mostrar_foto(self):
        self.boton_pista_foto.desactivar()
        self.boton_pista_definicion.desactivar()
        #Se mestra foto
        foto = Animal(animal=str(self.animal))
        #Se restan 25 puntos por ver foto
        self.puntos.aumentar(-50)
        self.puntos.escala = [2,1]
        #Se muestra la foto por 3 segundos
        tiempo=pilas.actores.Temporizador()
        tiempo.color = pilas.colores.negro
        tiempo.escala = [2,1,2,1,2,1],3
        def termino_el_tiempo():
            pts = self.puntos.obtener()
            tiempo.eliminar()
            foto.escala = [0,3]
            pilas.mundo.agregar_tarea(1,foto.eliminar)
            if pts>51:
                self.boton_pista_foto.activar()
            if pts>9:
                self.boton_pista_definicion.activar()
        tiempo.ajustar(3,termino_el_tiempo)
        tiempo.iniciar()

    def coloco_letra(self,cuadro,cartel):
        cuadro.set_colision(cartel.texto)
        cartel.x = cuadro.x
        cartel.y = cuadro.y

    def boton_terminado(self):
        self.b_fin = pilas.interfaz.Boton("Listo",y=100)
        def funcion():
            self.boton_pista_definicion.desactivar()
            self.boton_pista_foto.desactivar()
            self.b_fin.desactivar()
            cant_bien = 1
            for i in self.grupo_cuadros:
                if i.correcto():
                    cant_bien = cant_bien + 1
            if cant_bien == len(self.animal):
                self.termino()
            else:
                self.vidas.quitar_una_vida()
                self.puntos.aumentar(-15)
                self.puntos.escala = [2,1]
                if not self.vidas.le_quedan_vidas():
                    self.perdio()
                else:
                    pilas.avisar("Intentalo de nuevo")
                    self.bajar_letras()
                    self.sonido_bad.reproducir()
                    self.boton_pista_definicion.activar()
                    self.boton_pista_foto.activar()
                    self.b_fin.activar()
        self.b_fin.conectar(funcion)

    def bajar_letras(self):
        cant = 0
        pos = -265
        y1 = -150
        y2 = -210
        for i in self.carteles_letras:
            if cant == 11:
                pos = - 265
                y1 = y2
            i.x = [pos]
            i.y = [y1]
            cant = cant + 1
            pos = pos + 65


    def perdio(self):
        cartel = pilas.actores.Texto("Lo siento, ya no te quedan vidas \n \n          Perdiste una vida")
        self.puntos.eliminar()
        #Mostramos cual era
        for i in self.grupo_cuadros:
            l = pilas.actores.Texto(i.get_letra(),fuente="data/tipografias/dnrsq.ttf",x=i.x,y=i.y)
            l.color = pilas.colores.rojo
            l.escala = 2
        self.carteles_letras.eliminar()
        self.sonido_perdio.reproducir()
        self.finalizar_juego()

    def termino (self):
        pts = self.puntos.obtener()
        self.puntos.aumentar(20)
        cartel = pilas.actores.Texto("LO LOGRASTE! \n Hiciste %s puntos!"% pts)
        self.finalizar_juego(ptos = pts)
        self.sonido_good.reproducir()

    def finalizar_juego(self,ptos = -1):
        for i in self.carteles_letras:
            i.eliminar_habilidad(pilas.habilidades.Arrastrable)
        self.boton_pista_definicion.eliminar()
        self.boton_pista_foto.eliminar()
        self.b_fin.eliminar()
        # Cargamos puntaje en archivo aux
        archivo = open("data/ultimo_puntaje.txt",'wb')
        pickle.dump(ptos,archivo)
        archivo.close()
        #Opcion para volver
        boton_volver = pilas.interfaz.Boton("Volver al juego",y=-100)
        boton_volver.conectar(pilas.recuperar_escena)



'''pilas.iniciar(1024,712)

pilas.mundo.motor.alto_original = 712
pilas.mundo.motor.ancho_original = 1024
musica = pilas.sonidos.cargar("data/musica/Sneaky_Adventure.ogg")
pilas.cambiar_escena(minijuego_animales(2))

pilas.ejecutar()'''








